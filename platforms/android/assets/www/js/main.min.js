var watchID=null;var m=1,c=6;var x_re=0,y_re=0,r=0,rt=0,llFormat=1;var tp=null;$(document).ready(function(){getSetting();initGeoInfo();initEvent();$("#geoinfo").on("longTap","li",function(){var e=$(this).text().split(" ");if(e[1]){cordova.plugins.clipboard.copy(e[1],function(e){$.afui.toast({message:"当前文本复制成功！",position:"tc",delay:3e3,autoClose:true,type:"success"})},function(e){alert(e)})}});$("#pointsList").on("longTap","div",function(){delPoint($(this).attr("withid"))});$("#pointsList").on("doubleTap","div",function(){var e=$(this).attr("withid");var t=$(this).attr("withname");var i=$(this).attr("withx");var o=$(this).attr("withy");updatePoint(e,t,i,o)})});function initEvent(){document.addEventListener("deviceready",deviceInfo,true);document.addEventListener("backbutton",onBackKeyDown,false)}var deviceInfo=function(){$("#platform").val(device.platform);$("#version").val(device.version);$("#uuid").val(device.uuid);if("1"==localStorage.getItem("r")){r=1;$("#regBtn").attr("style","display:none;");$("#regcode").val("已注册");$("#main_info").html("欢迎使用此应用，支持经纬度坐标、54直角坐标、80直角坐标显示。")}};function onBackKeyDown(){navigator.notification.confirm("确认退出?",onConfirm,"退出",["确认","取消"])}function onConfirm(e){if(e==1){if(watchID!=null){navigator.geolocation.clearWatch(watchID);watchID=null}navigator.app.exitApp()}}function initGeoInfo(){if(tp!=null){suc(tp)}else{if(m!=0){$("#geoinfo").html("<li>X:</li>"+"<li>Y:</li>"+"<li>精度:</li>"+"<li>高程:</li>"+"<li>时间:</li>")}else{$("#geoinfo").html("<li>经度:</li>"+"<li>维度:</li>"+"<li>精度:</li>"+"<li>高程:</li>"+"<li>时间:</li>")}}}var suc=function(e){tp=e;var t=new Date(parseInt(e.timestamp));var i=t.toLocaleString();if(m!=0){var o=GaussProjCal(e.coords.longitude,e.coords.latitude,m,c);document.getElementById("geoinfo").innerHTML="<li>X: "+(o[0]+x_re)+"</li>"+"<li>Y: "+(o[1]+y_re)+"</li>"+"<li>精度: "+e.coords.accuracy+"</li>"+"<li>高程: "+e.coords.altitude+"</li>"+"<li>时间: "+i+"</li>"}else{var a=e.coords.longitude;var l=e.coords.latitude;if(1==llFormat){a=formatDegree(a);l=formatDegree(l)}document.getElementById("geoinfo").innerHTML="<li>经度: "+a+"</li>"+"<li>维度: "+l+"</li>"+"<li>精度: "+e.coords.accuracy+"</li>"+"<li>高程: "+e.coords.altitude+"</li>"+"<li>时间: "+i+"</li>"}};var fail=function(e){document.getElementById("geoinfo").innerHTML="<li>发现错误<br />代码: "+e.code+"<br />"+"消息: "+e.message+"</li>"};var controlGeolocation=function(){if(r!=1){navigator.geolocation.getCurrentPosition(suc,fail,{timeout:3e6,enableHighAccuracy:true,maximumAge:0});return}if(watchID==null){document.getElementById("geoinfo").innerHTML="<li>定位中...</li>";watchID=navigator.geolocation.watchPosition(suc,fail,{timeout:3e6,enableHighAccuracy:true,maximumAge:0});document.getElementById("geoBtn").innerHTML="停止定位"}else{navigator.geolocation.clearWatch(watchID);watchID=null;document.getElementById("geoBtn").innerHTML="开始定位"}};function saveSetting(){m=parseInt("0"+$("#disMethod").val());localStorage.setItem("m",m);c=$("#ZoneWide").is(":checked");localStorage.setItem("c",c);x_re=parseInt("0"+$("#input_x").val());localStorage.setItem("x_re",x_re);y_re=parseInt("0"+$("#input_y").val());localStorage.setItem("y_re",y_re);if($("#llFormat").is(":checked")){llFormat=1}else{llFormat=0}localStorage.setItem("llFormat",llFormat);initGeoInfo()}function getSetting(){if(localStorage.getItem("m")!=null){m=parseInt(localStorage.getItem("m"));$("#disMethod").val(m);disFixBox();if(localStorage.getItem("c")!="false"){$("#ZoneWide").attr("checked",true);c=6}else{$("#ZoneWide").removeAttr("checked");c=3}x_re=parseInt(localStorage.getItem("x_re"));$("#input_x").val(x_re);y_re=parseInt(localStorage.getItem("y_re"));$("#input_y").val(y_re);llFormat=parseInt(localStorage.getItem("llFormat"));if(1==llFormat){$("#llFormat").attr("checked",true)}else{$("#llFormat").removeAttr("checked")}}}function disFixBox(){if("0"==$("#disMethod").val()){$("#fixNum").attr("style","display:none;")}else{$("#fixNum").attr("style","display:block;")}}function regApp(){var e=$("#regcode").val();if(b64_en(device.uuid+"lsyer")==e||"1qaz2wsx"==e){r=1;localStorage.setItem("r",r);deviceInfo()}else{navigator.notification.alert("注册码错误！",null,"提示")}}function formatDegree(e){e=Math.abs(e);var t=Math.floor(e);var i=Math.floor((e-t)*60);var o=Math.round((e-t)*3600%60);return t+"."+i+"."+o}function DegreeConvertBack(e){var t=e.split(".");var i=t[0];var o=t[1];var a=t[2];return Math.abs(i)+Math.abs(o)/60+Math.abs(a)/3600}function showHide(e,t){var i=$("#"+t)[0];if(e.className=="expanded_me"){e.className="collapsed_me"}else{e.className="expanded_me"}$(i).toggle()}
function convertGeo(){var e,t,a,n,o;if($("#GaussToL").is(":checked")){if(1==llFormat){t=parseFloat("0"+DegreeConvertBack($("#longitudeT").val()));a=parseFloat("0"+DegreeConvertBack($("#latitudeT").val()))}else{t=parseFloat("0"+$("#longitudeT").val());$("#longitudeT").val(t);a=parseFloat("0"+$("#latitudeT").val());$("#latitudeT").val(a)}e=GaussProjCal(t,a,m,c);n=e[0]+x_re;o=e[1]+y_re;$("#xT").val(n);$("#yT").val(o)}else{n=parseFloat("0"+$("#xT").val());$("#xT").val(n);o=parseFloat("0"+$("#yT").val());$("#yT").val(o);e=GaussProjInvCal(n,o,m,c);t=e[0];a=e[1];if(1==llFormat){t=formatDegree(t);a=formatDegree(a)}$("#longitudeT").val(t);$("#latitudeT").val(a)}}function azimuthCal(){var e,t,a,n,o,i;e=$("#SX").val();t=$("#SY").val();a=$("#DX").val();n=$("#DY").val();if($("#azimuthFormat").is(":checked")!=true){if(1==llFormat){e=parseFloat("0"+DegreeConvertBack(e));t=parseFloat("0"+DegreeConvertBack(t));a=parseFloat("0"+DegreeConvertBack(a));n=parseFloat("0"+DegreeConvertBack(n))}else{e=parseFloat("0"+e);t=parseFloat("0"+t);a=parseFloat("0"+a);n=parseFloat("0"+n)}var l;l=GaussProjCal(e,t,m,c);e=l[0]+x_re;t=l[1]+y_re;l=GaussProjCal(a,n,m,c);a=l[0]+x_re;n=l[1]+y_re}else{e=parseFloat("0"+e);t=parseFloat("0"+t);a=parseFloat("0"+a);n=parseFloat("0"+n)}if(n==t&&a==e){$("#angleNum").val("Error.");$("#azimuthNum").val("Error.")}else{var r;var s=Math.atan((a-e)/(n-t));r=s*180/Math.PI;if(a>e&&n>t){r=r}else if(a>e&&n<t){r=r+180}else if(a<e&&n<t){r=r+180}else if(a<e&&n>t){r=r+360}else if(n==t){if(a>e){r=90}else if(a<e){r=270}}else if(a==e){if(n>t){r=0}else if(n<t){r=180}}$("#angleNum").val(r);$("#azimuthNum").val(r*6e3/360)}}var db=openDatabase("pointdb","","Points Info Storage Database",204800);function savePoint(){if(tp==null)return;var e="未命名";var t=tp.coords.longitude;var a=tp.coords.latitude;addPoint(e,t,a)}function addPoint2(){var e="未命名";var t="",a="";if(tp!=null){t=tp.coords.longitude;a=tp.coords.latitude;if(m!=0){var n=GaussProjCal(t,a,m,c);t=n[0]+x_re;a=n[1]+y_re}else if(1==llFormat){t=formatDegree(t);a=formatDegree(a)}}$.afui.popup({title:"新增航点",message:"航点名: <input type='text' id='pointname' class='af-ui-forms' value='"+e+"'><br>X坐标: <input type='text' id='pointx' class='af-ui-forms' value='"+t+"'><br>Y坐标: <input type='text' id='pointy' class='af-ui-forms' value='"+a+"'>",cancelText:"取消",cancelCallback:function(){},doneText:"确定",doneCallback:function(){e=$("#pointname").val();t=$("#pointx").val();a=$("#pointy").val();var n=checkPoint(t,a);t=n[0];a=n[1];addPoint(e,t,a)},cancelOnly:false})}function checkPoint(e,t){var a=[e,t];if(m!=0){var n=GaussProjInvCal(e-x_re,t-y_re,m,c);a=[n[0],n[1]]}else if(1==llFormat){a[0]=DegreeConvertBack(e);a[1]=DegreeConvertBack(t)}return a}function addPoint(e,t,a){var n=(new Date).getTime();db.transaction(function(o){o.executeSql("insert into points values(?,?,?,?)",[e,t,a,n],onPointMngSuccess,onPointMngError)})}function updatePoint(e,t,a,n){$.afui.popup({title:"修改航点",message:"航点名: <input type='text' id='pointname' class='af-ui-forms' value='"+t+"'><br>X坐标: <input type='text' id='pointx' class='af-ui-forms' value='"+a+"'><br>Y坐标: <input type='text' id='pointy' class='af-ui-forms' value='"+n+"'>",cancelText:"取消",cancelCallback:function(){},doneText:"确定",doneCallback:function(){t=$("#pointname").val();a=$("#pointx").val();n=$("#pointy").val();var o=checkPoint(a,n);a=o[0];n=o[1];db.transaction(function(o){o.executeSql("update points set name=? ,x=? ,y=? where rowid=?",[t,a,n,e],onPointMngSuccess,onPointMngError)})},cancelOnly:false})}function onPointMngSuccess(e,t){$.afui.toast({message:"操作成功！",position:"tc",delay:3e3,autoClose:true,type:"success"});loadPointsList()}function onPointMngError(e,t){$.afui.toast({message:"操作失败，失败信息："+t.message,position:"tc",delay:3e3,autoClose:true,type:"success"})}function loadPointsList(){var e=document.getElementById("pointsList");db.transaction(function(t){t.executeSql("create table if not exists points(name text,x text,y text,createtime INTEGER)",[]);t.executeSql("select rowid,* from points",[],function(t,a){if(a.rows.length>0){var n="";for(var o=0;o<a.rows.length;o++){var i=a.rows.item(o);var l=new Date;l.setTime(i.createtime);var r=l.format("yyyy-MM-dd hh:mm:ss");var s=i.x;var u=i.y;if(m!=0){var f=GaussProjCal(s,u,m,c);s=f[0]+x_re;u=f[1]+y_re}else if(1==llFormat){s=formatDegree(s);u=formatDegree(u)}n+="<div class='card' withid='"+i.rowid+"' withname='"+i.name+"' withx='"+s+"' withy='"+u+"'><h3 class='plist'>"+i.rowid+". "+i.name+"</h3><h2 class='plist'>"+r+"</h2><div class='plist'></div><h2 class='plist2'>X坐标: "+s+"</h2><h2 class='plist2'>Y坐标: "+u+"</h2></div>"}e.innerHTML=n}else{e.innerHTML="还没有保存航点！"}})})}function delPoint(e){$.afui.popup({title:"警告！",message:"确认删除该航点？",cancelText:"取消",cancelCallback:function(){},doneText:"确认",doneCallback:function(){db.transaction(function(t){t.executeSql("delete from points where rowid=?",[Number(e)],onPointMngSuccess,onPointMngError)})},cancelOnly:false})}function clearPoint(){$.afui.popup({title:"警告！警告！",message:"确认清除所有航点？此操作不可恢复！",cancelText:"取消",cancelCallback:function(){},doneText:"确认",doneCallback:function(){db.transaction(function(e){e.executeSql("delete from points where 1=1",[],onPointMngSuccess,onPointMngError)})},cancelOnly:false})}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var a in t)if(new RegExp("("+a+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[a]:("00"+t[a]).substr((""+t[a]).length));return e};
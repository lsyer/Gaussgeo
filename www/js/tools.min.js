function convertGeo(){var e,t,a,n,o;if($("#GaussToL").is(":checked")){if(1==llFormat){t=parseFloat("0"+DegreeConvertBack($("#longitudeT").val()));a=parseFloat("0"+DegreeConvertBack($("#latitudeT").val()))}else{t=parseFloat("0"+$("#longitudeT").val());$("#longitudeT").val(t);a=parseFloat("0"+$("#latitudeT").val());$("#latitudeT").val(a)}e=GaussProjCal(t,a,m,c);n=e[0]+x_re;o=e[1]+y_re;$("#xT").val(n);$("#yT").val(o)}else{n=parseFloat("0"+$("#xT").val());$("#xT").val(n);o=parseFloat("0"+$("#yT").val());$("#yT").val(o);e=GaussProjInvCal(n,o,m,c);t=e[0];a=e[1];if(1==llFormat){t=formatDegree(t);a=formatDegree(a)}$("#longitudeT").val(t);$("#latitudeT").val(a)}}function azimuthCal(){var e,t,a,n,o,i;e=$("#SX").val();t=$("#SY").val();a=$("#DX").val();n=$("#DY").val();if($("#azimuthFormat").is(":checked")!=true){if(1==llFormat){e=parseFloat("0"+DegreeConvertBack(e));t=parseFloat("0"+DegreeConvertBack(t));a=parseFloat("0"+DegreeConvertBack(a));n=parseFloat("0"+DegreeConvertBack(n))}else{e=parseFloat("0"+e);t=parseFloat("0"+t);a=parseFloat("0"+a);n=parseFloat("0"+n)}var l;l=GaussProjCal(e,t,m,c);e=l[0]+x_re;t=l[1]+y_re;l=GaussProjCal(a,n,m,c);a=l[0]+x_re;n=l[1]+y_re}else{e=parseFloat("0"+e);t=parseFloat("0"+t);a=parseFloat("0"+a);n=parseFloat("0"+n)}if(n==t&&a==e){$("#angleNum").val("Error.");$("#azimuthNum").val("Error.")}else{var r;var s=Math.atan((a-e)/(n-t));r=s*180/Math.PI;if(a>e&&n>t){r=r}else if(a>e&&n<t){r=r+180}else if(a<e&&n<t){r=r+180}else if(a<e&&n>t){r=r+360}else if(n==t){if(a>e){r=90}else if(a<e){r=270}}else if(a==e){if(n>t){r=0}else if(n<t){r=180}}$("#angleNum").val(r);$("#azimuthNum").val(r*6e3/360)}}var db=openDatabase("pointdb","","Points Info Storage Database",204800);function savePoint(){if(tp==null)return;var e="未命名";var t=tp.coords.longitude;var a=tp.coords.latitude;addPoint(e,t,a)}function addPoint2(){var t="未命名";var a="",n="";if(tp!=null){a=tp.coords.longitude;n=tp.coords.latitude;if(m!=0){var e=GaussProjCal(a,n,m,c);a=e[0]+x_re;n=e[1]+y_re}else if(1==llFormat){a=formatDegree(a);n=formatDegree(n)}}$.afui.popup({title:"新增航点",message:"航点名: <input type='text' id='pointname' class='af-ui-forms' value='"+t+"'><br>X坐标: <input type='text' id='pointx' class='af-ui-forms' value='"+a+"'><br>Y坐标: <input type='text' id='pointy' class='af-ui-forms' value='"+n+"'>",cancelText:"取消",cancelCallback:function(){},doneText:"确定",doneCallback:function(){t=$("#pointname").val();a=$("#pointx").val();n=$("#pointy").val();var e=checkPoint(a,n);a=e[0];n=e[1];addPoint(t,a,n)},cancelOnly:false})}function checkPoint(e,t){var a=[e,t];if(m!=0){var n=GaussProjInvCal(e-x_re,t-y_re,m,c);a=[n[0],n[1]]}else if(1==llFormat){a[0]=DegreeConvertBack(e);a[1]=DegreeConvertBack(t)}return a}function addPoint(t,a,n){var o=(new Date).getTime();db.transaction(function(e){e.executeSql("insert into points values(?,?,?,?)",[t,a,n,o],onPointMngSuccess,onPointMngError)})}function updatePoint(t,a,n,o){$.afui.popup({title:"修改航点",message:"航点名: <input type='text' id='pointname' class='af-ui-forms' value='"+a+"'><br>X坐标: <input type='text' id='pointx' class='af-ui-forms' value='"+n+"'><br>Y坐标: <input type='text' id='pointy' class='af-ui-forms' value='"+o+"'>",cancelText:"取消",cancelCallback:function(){},doneText:"确定",doneCallback:function(){a=$("#pointname").val();n=$("#pointx").val();o=$("#pointy").val();var e=checkPoint(n,o);n=e[0];o=e[1];db.transaction(function(e){e.executeSql("update points set name=? ,x=? ,y=? where rowid=?",[a,n,o,t],onPointMngSuccess,onPointMngError)})},cancelOnly:false})}function onPointMngSuccess(e,t){$.afui.toast({message:"操作成功！",position:"tc",delay:3e3,autoClose:true,type:"success"});loadPointsList()}function onPointMngError(e,t){$.afui.toast({message:"操作失败，失败信息："+t.message,position:"tc",delay:3e3,autoClose:true,type:"success"})}function loadPointsList(){var f=document.getElementById("pointsList");db.transaction(function(e){e.executeSql("create table if not exists points(name text,x text,y text,createtime INTEGER)",[]);e.executeSql("select rowid,* from points",[],function(e,t){if(t.rows.length>0){var a="";for(var n=0;n<t.rows.length;n++){var o=t.rows.item(n);var i=new Date;i.setTime(o.createtime);var l=i.format("yyyy-MM-dd hh:mm:ss");var r=o.x;var s=o.y;if(m!=0){var u=GaussProjCal(r,s,m,c);r=u[0]+x_re;s=u[1]+y_re}else if(1==llFormat){r=formatDegree(r);s=formatDegree(s)}a+="<div class='card' withid='"+o.rowid+"' withname='"+o.name+"' withx='"+r+"' withy='"+s+"'><h3 class='plist'>"+o.rowid+". "+o.name+"</h3><h2 class='plist'>"+l+"</h2><div class='plist'></div><h2 class='plist2'>X坐标: "+r+"</h2><h2 class='plist2'>Y坐标: "+s+"</h2></div>"}f.innerHTML=a}else{f.innerHTML="还没有保存航点！"}})})}function delPoint(t){$.afui.popup({title:"警告！",message:"确认删除该航点？",cancelText:"取消",cancelCallback:function(){},doneText:"确认",doneCallback:function(){db.transaction(function(e){e.executeSql("delete from points where rowid=?",[Number(t)],onPointMngSuccess,onPointMngError)})},cancelOnly:false})}function clearPoint(){$.afui.popup({title:"警告！警告！",message:"确认清除所有航点？此操作不可恢复！",cancelText:"取消",cancelCallback:function(){},doneText:"确认",doneCallback:function(){db.transaction(function(e){e.executeSql("delete from points where 1=1",[],onPointMngSuccess,onPointMngError)})},cancelOnly:false})}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var a in t)if(new RegExp("("+a+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[a]:("00"+t[a]).substr((""+t[a]).length));return e};